<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Credits — Sabotaged Sessions</title>
  <meta name="description" content="Credits for FNF: VS Impostor — Sabotaged Sessions. Meet the team." />
  <link rel="stylesheet" href="credits-style.css">
</head>
<body>
  <header class="site-header">
    <div class="brand">
      <div class="logo">⚠️</div>
      <div>
        <h1>Sabotaged Sessions</h1>
        <p class="muted">Credits — CrewCreators</p>
      </div>
    </div>

    <nav class="topnav" aria-label="Primary">
      <a href="index.html">Home</a>
      <a href="news.html">News</a>
      <a href="credits.html" class="active">Credits</a>
      <a href="index.html#contact">Contact</a>
    </nav>
  </header>

  <main class="container" id="main">
    <section class="controls">
      <div class="search">
        <label for="searchInput" class="sr-only">Search contributors</label>
        <input id="searchInput" placeholder="Search people or roles (e.g. 'composer', 'jacob')" />
      </div>

      <div class="filters">
        <label for="roleSelect">Filter role</label>
        <select id="roleSelect">
          <option value="">— all roles —</option>
        </select>
        <button id="exportJson" class="btn subtle">Export JSON</button>
        <button id="exportCsv" class="btn subtle">Export CSV</button>
      </div>
    </section>

    <section id="creditsGrid" class="grid" aria-live="polite">
      <!-- JS populates cards here -->
      <div class="loader" id="loader">Loading credits…</div>
    </section>

    <section class="notes">
      <h3>Maintaining credits</h3>
      <p class="muted">Edit <code>credits.json</code> in your repo and push — this page will render the new list automatically. Keep roles consistent (role → people → {name, credit}).</p>
    </section>
  </main>

  <footer class="site-footer">
    <small>© CrewCreators — Sabotaged Sessions • Built for the community</small>
  </footer>

  <script>
  // credits page script (self-contained)
  (function () {
    const JSON_PATH = 'credits.json';
    const grid = document.getElementById('creditsGrid');
    const loader = document.getElementById('loader');
    const roleSelect = document.getElementById('roleSelect');
    const searchInput = document.getElementById('searchInput');
    const exportJsonBtn = document.getElementById('exportJson');
    const exportCsvBtn = document.getElementById('exportCsv');

    let creditsData = [];

    function safeText(t){ return (t||'').toString(); }
    function createCard(role, person){
      const card = document.createElement('article');
      card.className = 'card';
      card.dataset.role = role;
      card.innerHTML = `
        <div class="avatar" aria-hidden="true">${(person.name||' ')[0].toUpperCase()}</div>
        <div class="card-body">
          <h4 class="person-name">${escapeHtml(person.name)}</h4>
          <div class="person-role">${escapeHtml(role)}</div>
          <p class="person-credit">${escapeHtml(person.credit||'')}</p>
        </div>
      `;
      return card;
    }
    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, (m) => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }

    function renderList(data){
      grid.innerHTML = '';
      const frag = document.createDocumentFragment();
      data.forEach(group => {
        (group.people||[]).forEach(person => {
          frag.appendChild(createCard(group.role, person));
        });
      });
      grid.appendChild(frag);
    }

    function populateRoleFilter(data){
      const roles = data.map(r=>r.role).filter(Boolean);
      roleSelect.innerHTML = '<option value="">— all roles —</option>' + roles.map(r=>`<option value="${escapeHtml(r)}">${escapeHtml(r)}</option>`).join('');
    }

    function applyFilters(){
      const q = (searchInput.value||'').trim().toLowerCase();
      const sel = (roleSelect.value||'').toLowerCase();
      const cards = grid.querySelectorAll('.card');
      cards.forEach(card => {
        const name = card.querySelector('.person-name').textContent.toLowerCase();
        const role = card.dataset.role.toLowerCase();
        const credit = card.querySelector('.person-credit').textContent.toLowerCase();
        const matchesSearch = !q || name.includes(q) || role.includes(q) || credit.includes(q);
        const matchesRole = !sel || role === sel;
        card.style.display = (matchesSearch && matchesRole) ? '' : 'none';
      });
    }

    function flattenToCSV(data){
      const rows = [['role','name','credit']];
      data.forEach(group => {
        (group.people||[]).forEach(p=>{
          rows.push([group.role, p.name || '', p.credit || '']);
        });
      });
      return rows.map(r => r.map(cell => `"${String(cell).replace(/"/g,'""')}"`).join(',')).join('\\n');
    }

    function download(filename, content, mime='text/plain'){
      const blob = new Blob([content], {type: mime});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename; document.body.appendChild(a); a.click();
      a.remove(); URL.revokeObjectURL(url);
    }

    async function loadCredits(){
      loader.style.display = '';
      try {
        const res = await fetch(JSON_PATH + '?_=' + Date.now());
        if(!res.ok) throw new Error('Failed to load credits.json (' + res.status + ')');
        const j = await res.json();
        if(!Array.isArray(j)) throw new Error('credits.json root must be an array');
        creditsData = j;
        renderList(creditsData);
        populateRoleFilter(creditsData);
        loader.style.display = 'none';
      } catch(err){
        loader.textContent = 'Error loading credits: ' + err.message;
        console.error(err);
      }
    }

    // events
    roleSelect.addEventListener('change', applyFilters);
    searchInput.addEventListener('input', applyFilters);
    exportJsonBtn.addEventListener('click', ()=> download('credits-export.json', JSON.stringify(creditsData, null, 2), 'application/json'));
    exportCsvBtn.addEventListener('click', ()=> download('credits-export.csv', flattenToCSV(creditsData), 'text/csv'));

    // startup
    loadCredits();

    // keyboard accessibility: focus search on "/" key
    window.addEventListener('keydown', function(e){
      if(e.key === '/' && document.activeElement !== searchInput){
        e.preventDefault();
        searchInput.focus();
      }
    });
  })();
  </script>
</body>
</html>